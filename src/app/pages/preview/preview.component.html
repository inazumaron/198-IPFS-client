<nz-page-header
  class="site-page-header"
  nzTitle="Your IPFS Desktop"
  nzSubtitle="Browse your IPFS files"
>
  <nz-page-header-extra>
    <i nz-icon *ngIf="lowPeers" nzType="disconnect" nzTheme="outline"></i>
    <a
      nz-dropdown
      nzPlacement="bottomRight"
      nzTrigger="click"
      [nzDropdownMenu]="menu"
    >
      <button nz-button nzType="primary">IPFS operations</button>
    </a>
    <nz-dropdown-menu #menu="nzDropdownMenu">
      <ul nz-menu>
        <li nz-menu-item>
          <a (click)="uploadFile()"> Share File </a>
        </li>
        <li nz-menu-item>
          <a (click)="uploadFileEncrypted()"> Share File Securely</a>
        </li>
        <li nz-menu-item>
          <a (click)="importCID()"> Receive File </a>
        </li>
        <li nz-menu-item>
          <a (click)="importCIDDecrypted()"> Save locally</a>
        </li>
        <li nz-menu-item>
          <a (click)="makeFolder()"> Create Folder </a>
        </li>
      </ul>
    </nz-dropdown-menu>
  </nz-page-header-extra>
</nz-page-header>

<div class="breadcrumb">
  <nz-breadcrumb>
    <nz-breadcrumb-item>
      <a (click)="navHome()"> Home </a>
    </nz-breadcrumb-item>
    <nz-breadcrumb-item *ngFor="let level of levels; let i = index">
      <a (click)="navDirectory(i)">{{ level }}</a>
    </nz-breadcrumb-item>
  </nz-breadcrumb>
</div>
<br />

<div class="files">
  <nz-spin [nzSpinning]="isLoading">
    <nz-list *ngIf="data.length" nzBordered>
      <nz-list-item
        *ngFor="let item of data"
        (click)="viewEntry(item)"
        (contextmenu)="contextMenu($event, ctxMenu, item)"
      >
        <i
          nz-icon
          *ngIf="item.type == 'file' && item.status_content == 'available'"
          nzType="file-text"
          nzTheme="outline"
        ></i>
        <i
          nz-icon
          *ngIf="item.type == 'directory' && item.status_content == 'available'"
          nzType="folder"
          nzTheme="outline"
        ></i>
        <i
          nz-icon
          *ngIf="
            item.type == 'file' &&
            (item.status_content == 'searching' ||
              item.status_content == 'downloading')
          "
          nzType="loading"
          nzTheme="outline"
        ></i>

        <div nz-tooltip nzTooltipTitle="cancel import">
            <i nz-icon 
            *ngIf="item.type == 'file' &&
            item.status_content == 'searching'"
            nzType="close" nzTheme="outline"
            (click)="cancelImport(item)"
            ></i>  
        </div>
      
        <i
          nz-icon
          *ngIf="item.type == 'failed' || item.status_content == 'timeout'"
          nzType="close"
          nzTheme="outline"
        ></i>

        &nbsp; &nbsp;
        <span *ngIf="item.status_content == 'searching'">
          Searching file on network
        </span>
        <span *ngIf="item.status_content == 'downloading'"> Downloading </span>
        <span *ngIf="item.status_content == 'failed'"> Import failed </span>
        <span *ngIf="item.status_content == 'timeout'">
          File not found on network
        </span>
        <span *ngIf="item.status_content == 'available'">
          {{ item.name }}
        </span>

        &mdash; &nbsp; &nbsp;

        <small (click)="copyCID(item)">
          {{ item.cid }}
        </small>

        <div
          *ngIf="item.type == 'file'"
          nz-tooltip
          nzTooltipTitle="Encrypted"
          class="actions"
        >
          <i
            *ngIf="item.is_encrypted"
            nz-icon
            nzType="lock"
            nzTheme="outline"
          ></i>
        </div>

        <div
          *ngIf="item.status_content == 'available'"
          nz-tooltip
          [nzTooltipTitle]="item.status_pin == 'unpinned' ? 'Pin' : 'Unpin'"
          class="download-actions"
        >
          <i
            *ngIf="item.type == 'file' && item.status_pin == 'unpinned'"
            nz-icon
            nzType="pushpin"
            nzTheme="outline"
            (click)="pin(item)"
          ></i>
          <i
            *ngIf="item.type == 'file' && item.status_pin == 'pinned'"
            nz-icon
            nzType="pushpin"
            nzTheme="fill"
            (click)="unpin(item)"
          ></i>
          <i
            *ngIf="item.type == 'file' && item.status_pin == 'queued'"
            nz-icon
            nzType="loading"
            nzTheme="outline"
            (click)="queue()"
          ></i>
        </div>
        <div
          class="download-actions"
          *ngIf="item.type == 'file' && item.status_content == 'available'"
          nz-tooltip
          nzTooltipTitle="Save locally"
        >
          <i
            (click)="download(item.cid, item.name)"
            nz-icon
            nzType="download"
            nzTheme="outline"
          ></i>
        </div>
      </nz-list-item>
    </nz-list>

    <div *ngIf="data.length < 10 && data.length" (contextmenu)="contextMenuEmpty($event, ctxMenuEmpty)" class="blankSpace">
      <div *ngFor="let blank of blankSpace">
        <br />
        <br />
      </div>
    </div>

    <div
      (contextmenu)="contextMenuEmpty($event, ctxMenuEmpty)"
      *ngIf="!data.length"
    >
      <br /><br />
      <nz-empty
        (contextmenu)="contextMenuEmpty($event, ctxMenuEmpty)"
      ></nz-empty>
    </div>
  </nz-spin>
</div>

<nz-dropdown-menu #ctxMenu="nzDropdownMenu">
  <ul class="menu" nz-menu>
    <!--<li nz-menu-item (click)="view()">Download</li>-->
    <li nz-menu-item (click)="copy()">Copy</li>
    <li nz-menu-item (click)="move()">Cut</li>
    <li nz-menu-item (click)="delete()">Delete</li>
    <li *ngIf="clipboard != ''" (click)="paste()" nz-menu-item>Paste</li>
  </ul>
</nz-dropdown-menu>

<nz-dropdown-menu #ctxMenuEmpty="nzDropdownMenu">
  <ul class="menu" nz-menu>
    <li *ngIf="clipboard != ''" (click)="paste()" nz-menu-item>Paste</li>
  </ul>
</nz-dropdown-menu>
